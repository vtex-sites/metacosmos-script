{"version":3,"file":"gift.39e9a9fb.js","sources":["../../src/pages/face-analysis/FaceAnalysisGift.svelte"],"sourcesContent":["<script lang=\"ts\">\n  import { analytics } from \"@lib/analytics\"\n  import { Paths, useRouter } from \"@lib/router\"\n  import * as SCA from \"@lib/sca\"\n  import { skinCare } from \"@pages/best-match/stores\"\n  import { setSourceChanged } from \"@pages/gift\"\n  import imageSource from \"../best-match/stores/image-source\"\n  import AnalysisProgress from \"./AnalysisProgress.svelte\"\n  import CameraFrameCapture from \"./CameraFrameCapture.svelte\"\n  import { percent, result, step } from \"./state\"\n\n  const router = useRouter()\n\n  let screen: typeof CameraFrameCapture | typeof AnalysisProgress\n\n  $: {\n    if (!$imageSource) break $\n    if ($imageSource.type === \"photo\") screen = AnalysisProgress\n    else if ($imageSource.type === \"webcam\" && $imageSource.data) screen = AnalysisProgress\n    else screen = CameraFrameCapture\n  }\n  $: {\n    if (!$imageSource) break $\n    if ($imageSource.type === \"photo\") analyze($imageSource.data)\n    else if ($imageSource.type === \"webcam\" && $imageSource.data) analyze($imageSource.data)\n  }\n\n  const analyze = async (photo: Blob) => {\n    setSourceChanged(true)\n\n    analytics.face_analysis_started()\n\n    $result = await SCA.analyze(photo, (progress) => {\n      $percent = progress.percent\n      $step = progress.step\n    })\n\n    skinCare.resetQuiz()\n    analytics.face_analysis_finished()\n  }\n</script>\n\n<svelte:component\n  this={screen}\n  intro={$imageSource?.type === \"webcam\"}\n  isGift\n  on:photo={({ detail }) => $imageSource && ($imageSource.data = detail)}\n  on:ended={() => router.push(Paths.GiftSelection)}\n/>\n"],"names":["ctx","_a","router","useRouter","screen","analyze","photo","setSourceChanged","analytics","$result","SCA.analyze","progress","$percent","$step","skinCare","photo_handler","detail","$imageSource","set_store_value","imageSource","ended_handler","Paths","$","$$invalidate","AnalysisProgress","CameraFrameCapture"],"mappings":"4WA2CQA,EAAM,6CACLC,EAAAD,EAAY,KAAZ,YAAAC,EAAc,QAAS,oMAAvBA,EAAAD,EAAY,KAAZ,YAAAC,EAAc,QAAS,iBADxBD,EAAM,IAAA,+YAhCN,MAAAE,EAASC,QAEXC,EAcE,MAAAC,QAAiBC,GAAW,CAChCC,EAAiB,EAAI,EAErBC,EAAU,sBAAqB,MAE/BC,QAAgBC,EAAYJ,EAAQK,GAAQ,KAC1CC,EAAWD,EAAS,QAAOC,CAAA,MAC3BC,EAAQF,EAAS,KAAIE,CAAA,OAGvBC,EAAS,UAAS,EAClBN,EAAU,uBAAsB,GAQrBO,EAAA,CAAA,CAAA,OAAAC,CAAM,IAAOC,GAAYC,EAAAC,EAAKF,EAAa,KAAOD,EAAMC,CAAA,EACrDG,EAAA,IAAAlB,EAAO,KAAKmB,EAAM,aAAa,2CAhC/CC,EAAC,CACM,GAAA,CAAAL,QAAoBK,EACrBL,EAAa,OAAS,QAAOM,EAAA,EAAEnB,EAASoB,CAAgB,EACnDP,EAAa,OAAS,UAAYA,EAAa,KAAIM,EAAA,EAAEnB,EAASoB,CAAgB,EAAAD,EAAA,EAClFnB,EAASqB,CAAkB,oBAElCH,EAAC,CACM,GAAA,CAAAL,QAAoBK,GACrBL,EAAa,OAAS,SACjBA,EAAa,OAAS,UAAYA,EAAa,OAAMZ,EAAQY,EAAa,IAAI"}