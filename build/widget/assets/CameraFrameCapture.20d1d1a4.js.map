{"version":3,"mappings":"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","names":["CheckmarkLg","sm","xs","ctx","insert","target","container","$$value","$$invalidate","cx","$$restProps","size","active","md","lg","child_ctx","each_value","i","x","min","max","mounted","file","resolve","reject","reader","error","Season","creamColorRangesEndpoint","analyze","image","onProgress","probabilities","Seasons","creamRanges","toBase64","r","__vitePreload","m","fakeProgress","index","season","description","duration","random","durationByStep","percent","step","range","delay","ticks","t","timers","count","dt","append","article","article_intro","t0_value","div","label","div_intro","div_outro","createEventDispatcher","$step","finished","$completed","move","current","introend_handler","titles","done","takePhoto","Analysis.useWebcam","wcam","webar","loaded","res","dispatch","hasLightEventListener","onMount","Analysis.addEventListener","hasFaceEventListener","Analysis.start","onDestroy","Analysis.unmount","Analysis.removeEventListener","$imageSource","Analysis.render","section","dialog","time","readable","set","it","viewer","countdown","hasFace","detail","hasLight","transitionend_handler","hint","flash","photo","createCountdown"],"sources":["../../src/lib/elements/Icon/svg/checkmark-lg.svg","../../src/lib/elements/Icon/svg/checkmark-sm.svg","../../src/lib/elements/Icon/svg/checkmark-xs.svg","../../src/lib/elements/Checkmark/Checkmark.svelte","../../src/lib/elements/Progress/Progress.svelte","../../src/lib/elements/Transition/Transition.svelte","../../src/lib/sca/utils.ts","../../src/lib/sca/index.ts","../../src/pages/face-analysis/AnalysisProgress.svelte","../../src/pages/face-analysis/Viewer.svelte","../../src/pages/face-analysis/CameraFrameCapture.svelte"],"sourcesContent":["export default \"__VITE_ASSET__afb796e2__\"","export default \"__VITE_ASSET__37c31f2f__\"","export default \"__VITE_ASSET__c0726a05__\"","<script context=\"module\" lang=\"ts\">\n  type Size = \"auto\" | \"xs\" | \"lg\"\n\n  export type { Size }\n</script>\n\n<script lang=\"ts\">\n  import lg from \"../Icon/svg/checkmark-lg.svg\"\n  import md from \"../Icon/svg/checkmark-md.svg\"\n  import sm from \"../Icon/svg/checkmark-sm.svg\"\n  import xs from \"../Icon/svg/checkmark-xs.svg\"\n  import { cx } from \"../utils\"\n\n  export let active = false\n  export let size: Size = \"auto\"\n\n  $: classes = cx(\"tint-checkmark\", $$restProps.class, size, active && \"active\")\n\n  // FIXME: currently it's not possible to use url('./checkmark.svg') inside css due to vite.config.js `emitCss: false` setting\n  let container: HTMLElement\n  $: container &&\n    (container.style.setProperty(\"--icon-xs\", `url(\"${xs}\")`),\n    container.style.setProperty(\"--icon-sm\", `url(\"${sm}\")`),\n    container.style.setProperty(\"--icon-md\", `url(\"${md}\")`),\n    container.style.setProperty(\"--icon-lg\", `url(\"${lg}\")`))\n</script>\n\n<i class={classes} bind:this={container} />\n\n<style lang=\"postcss\">\n  i {\n    @apply inline-block h-7 w-7 rounded-full bg-[#dcdcdd] bg-[image:var(--icon-sm)] bg-center bg-no-repeat transition-colors;\n    @apply md:h-8 md:w-8 md:bg-[image:var(--icon-md)] lg:h-[2.625rem] lg:w-[2.625rem] lg:bg-[image:var(--icon-lg)];\n  }\n\n  .xs {\n    @apply h-5 w-5 bg-[image:var(--icon-xs)];\n  }\n\n  .lg {\n    @apply h-[2.625rem] w-[2.625rem] bg-[image:var(--icon-lg)];\n  }\n\n  .active {\n    @apply bg-[#4ccc75];\n  }\n</style>\n","<script context=\"module\" lang=\"ts\">\n  const clamp = (x: number, min: number, max: number) => Math.min(Math.max(min, x), max)\n</script>\n\n<script lang=\"ts\">\n  export let max = 100\n  export let value = max / 2\n  export let chunks = 1\n</script>\n\n<!-- Styling of native HTMLProgressElement is miserable -->\n<div\n  class=\"tint-progress\"\n  role=\"progressbar\"\n  aria-valuemax={max}\n  aria-valuenow={value}\n  {...$$restProps}\n>\n  {#each new Array(chunks) as _, idx}\n    {@const relativeMax = max / chunks}\n    {@const relativeValue = clamp(((value - idx * relativeMax) / relativeMax) * 100, 0, max)}\n    <div class=\"chunk\" style={`--value: ${relativeValue}`} />\n  {/each}\n</div>\n\n<style lang=\"postcss\">\n  .tint-progress {\n    @apply inline-flex h-2 w-full gap-1 rounded lg:gap-2;\n  }\n\n  .chunk {\n    @apply relative h-full w-full rounded-[inherit] bg-[#dcdcdd];\n\n    &::after {\n      @apply absolute top-0 left-0 h-full w-[calc(var(--value)*1%)] rounded-[inherit] bg-[#4ccc75] transition-[width] content-[\"\"];\n    }\n  }\n</style>\n","<!-- https://github.com/sveltejs/svelte/issues/2845 -->\n<script lang=\"ts\">\n  import { onMount } from \"svelte\"\n\n  export let intro = false\n\n  let mounted = false\n\n  onMount(() => (mounted = true))\n</script>\n\n{#if intro}\n  {#if mounted}\n    <slot />\n  {/if}\n{:else}\n  <slot />\n{/if}\n","export const toBase64 = async (file: Blob) => {\n  const base64DataUrl = await new Promise<string>((resolve, reject) => {\n    const reader = new FileReader()\n    reader.onload = () => resolve(reader.result as string)\n    reader.onerror = (error) => reject(error)\n    reader.readAsDataURL(file)\n  })\n\n  return base64DataUrl.replace(/^data:.*?,/, \"\")\n}\n","import { timers } from \"@banuba/webar\"\nimport type { BestColors } from \"@lib/sca/best-colors\"\nimport { random } from \"@lib/utils/lodash\"\nimport { toBase64 } from \"./utils\"\n\nexport type HexColor = string\nexport type ImageUrl = string\n\nexport enum AnalysisStep {\n  SkinType = 0,\n  SkinTone = 1,\n  ColorType = 2,\n  FacialFeatures = 3,\n}\n\nexport type AnalysisProgress = {\n  percent: number\n  step: AnalysisStep\n}\n\ntype ProgressCallback = (progress: AnalysisProgress) => void\n\nexport interface CreamColors {\n  bb_colors: string[]\n  cc_colors: string[]\n}\nexport interface CreamColorsRanges {\n  BB: number[]\n  CC: number[]\n}\n\nexport enum Season {\n  SPRING = 0,\n  SUMMER = 1,\n  AUTUMN = 2,\n  WINTER = 3,\n}\n\nexport type AnalysisResult = {\n  season: keyof typeof Season\n  title: string\n  skinTones: HexColor[]\n  hairTones: HexColor[]\n  eyeTones: HexColor[]\n  tonesDescription: string\n  celebrities: string[]\n  bestColors: BestColors\n  colorsDescription: string\n  appearances: ImageUrl[]\n  creamRanges?: CreamColorsRanges\n}\n\ntype SeasonColorAnalysisResponse = [\n  SpringProbability: number,\n  SummerProbability: number,\n  AutumnProbability: number,\n  WinterProbability: number\n]\n\nconst creamColorRangesEndpoint = `${import.meta.env.VITE_SCA_ENDPOINT}bb-cc-recommender-v2`\n\nexport const analyze = async (\n  image: Blob,\n  onProgress: ProgressCallback = () => {}\n): Promise<AnalysisResult> => {\n  const [probabilities, Seasons, creamRanges] = await Promise.all([\n    fetch(import.meta.env.VITE_SCA_ENDPOINT, {\n      method: \"POST\",\n      body: JSON.stringify({\n        isBase64Encoded: true,\n        body: await toBase64(image),\n      }),\n    }).then((r) => r.json() as Promise<SeasonColorAnalysisResponse>),\n\n    import(\"./seasons\").then((m) => m.default),\n\n    fetch(creamColorRangesEndpoint, {\n      method: \"POST\",\n      body: JSON.stringify({\n        isBase64Encoded: true,\n        body: await toBase64(image),\n      }),\n    }).then((r) => r.json() as Promise<CreamColorsRanges>),\n\n    fakeProgress(onProgress),\n  ])\n\n  const index = probabilities.indexOf(Math.max(...probabilities))\n  const season = Season[index] as keyof typeof Season\n\n  const description = Seasons[season]\n\n  return {\n    season,\n    ...description,\n    creamRanges,\n  }\n}\n\nexport const fakeProgress = async (onProgress: ProgressCallback = () => {}) => {\n  const duration = random(3.8 * 1000, 4.8 * 1000)\n  const durationByStep = {\n    [AnalysisStep.SkinType]: duration * 0.25,\n    [AnalysisStep.SkinTone]: duration * 0.19,\n    [AnalysisStep.ColorType]: duration * 0.22,\n    [AnalysisStep.FacialFeatures]: duration * 0.34,\n  }\n\n  let percent = 0\n\n  // processing simulation\n  for (const [step, duration] of Object.entries(durationByStep)) {\n    const range = 100 / Object.keys(durationByStep).length\n\n    onProgress({ percent, step: +step })\n\n    await delay(300)\n\n    for await (const _ of ticks(range, duration)) onProgress({ percent: ++percent, step: +step })\n  }\n}\n\nconst delay = (t: number) => new Promise<void>((r) => timers.setTimeout(r, t))\n\nasync function* ticks(count: number, duration: number) {\n  const dt = duration / count\n\n  while (count-- > 0) yield await delay(dt)\n}\n","<script context=\"module\" lang=\"ts\">\n  const titles = [\"Skin type\", \"Skin tone\", \"Color type\", \"Facial features\"]\n</script>\n\n<script lang=\"ts\">\n  import { createEventDispatcher } from \"svelte\"\n  import { fade } from \"svelte/transition\"\n  import { Checkmark, Icon, Progress, Transition } from \"@lib/elements\"\n  import CheckmarkLg from \"@lib/elements/Icon/svg/checkmark-lg.svg\"\n  import { completed, percent, step } from \"./state\"\n\n  export let intro = false\n  export let isGift: boolean = false\n\n  const dispatch = createEventDispatcher<{ ended: void }>()\n\n  let current = $step\n  let finished = $completed\n\n  $: title = titles[current]\n  $: done = current < $step || $completed\n\n  const move = () => (current = $step)\n\n  $: done && setTimeout(move, 600) // let user to see the step completion status\n  $: $completed && setTimeout(() => (finished = true), 600) // let user to see the last step completion status\n</script>\n\n<section class=\"tint-face-analysis\">\n  {#if finished}\n    <article\n      in:fade|local={{ delay: 400, duration: 800 }}\n      on:introend={() => setTimeout(() => dispatch(\"ended\"), 600)}\n    >\n      <h2>\n        <Checkmark size=\"lg\" active />\n        {#if isGift}\n          Gift selection finished.\n        {:else}\n          Analysis finished.\n        {/if}\n      </h2>\n      <p>Personalized product recommendations are ready.</p>\n    </article>\n  {:else}\n    <Transition {intro}>\n      <div in:fade|local={{ delay: 100, duration: 600 }} out:fade={{ duration: 150 }}>\n        <!-- svelte-ignore a11y-label-has-associated-control : it's ok to wrap <progress> with <label> -->\n        <label>\n          <span>{`${isGift ? \"Gift selection\" : \"Analyzing\"} ${$percent}%`}</span>\n          <Progress value={$percent} chunks={titles.length} />\n        </label>\n        <p class:completed={done}>\n          <Icon src={CheckmarkLg} />\n          {title}...\n        </p>\n      </div>\n    </Transition>\n  {/if}\n</section>\n\n<style lang=\"postcss\">\n  section {\n    @apply relative h-full w-full;\n    @apply xl:max-h-[48.5rem] xl:max-w-[75rem] xl:rounded-xl;\n\n    & > :global(*) {\n      @apply absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2;\n    }\n  }\n\n  article {\n    @apply relative flex shrink-0 flex-col items-center;\n  }\n\n  h2 {\n    @apply absolute -top-2 flex -translate-y-full flex-col items-center gap-4 text-xl md:gap-5 md:text-2xl;\n  }\n\n  div {\n    @apply flex shrink-0 flex-col gap-7 text-center;\n  }\n\n  label {\n    @apply flex flex-col gap-3 text-xl font-bold md:gap-4 md:text-2xl;\n    @apply w-[19.375rem] md:w-[21rem] lg:w-[47.5rem];\n  }\n\n  label + p {\n    @apply flex justify-center text-base;\n\n    & > :global(:first-child) {\n      @apply mr-1 text-[#4ccc75] transition-opacity;\n    }\n\n    &:not(.completed) > :global(:first-child) {\n      @apply opacity-0 transition-none;\n    }\n\n    & :global(path) {\n      @apply stroke-current;\n    }\n  }\n</style>\n","<script lang=\"ts\">\n  import { createEventDispatcher, onDestroy, onMount } from \"svelte\"\n  import { Analysis } from \"@lib/webar\"\n  import imageSource from \"../best-match/stores/image-source\"\n\n  const dispatch = createEventDispatcher<{\n    hasFace: boolean\n    hasLight: boolean\n  }>()\n\n  export const takePhoto = () => Analysis.useWebcam().then((wcam) => wcam.takePhoto())\n\n  let webar: HTMLElement\n\n  /** defines if Analysis is loaded */\n  let loaded = false\n\n  // sync Analysis image source with the state's one\n  $: $imageSource && $imageSource.type === \"webcam\" && loaded && Analysis.useWebcam()\n\n  $: loaded && Analysis.render(webar)\n\n  const hasFaceEventListener = (res: boolean) => dispatch(\"hasFace\", res)\n  const hasLightEventListener = (res: boolean) => dispatch(\"hasLight\", res)\n\n  onMount(() => {\n    Analysis.addEventListener(\"face\", hasFaceEventListener)\n    Analysis.addEventListener(\"lightning\", hasLightEventListener)\n    Analysis.start().then(() => (loaded = true))\n  })\n  onDestroy(() => {\n    Analysis.unmount(webar)\n    Analysis.removeEventListener(\"face\", hasFaceEventListener)\n    Analysis.removeEventListener(\"lightning\", hasLightEventListener)\n  })\n</script>\n\n<div bind:this={webar} />\n\n<style lang=\"postcss\">\n  div,\n  div > :global(canvas) {\n    @apply h-full w-full;\n  }\n</style>\n","<script context=\"module\" lang=\"ts\">\n  import { readable } from \"svelte/store\"\n\n  const createCountdown = (time: number) =>\n    readable(time, (set) => {\n      const it = setInterval(() => {\n        set((time -= 1))\n        if (time <= 0) clearInterval(it)\n      }, 1000)\n\n      return () => clearInterval(it)\n    })\n</script>\n\n<script lang=\"ts\">\n  import { createEventDispatcher } from \"svelte\"\n  import { Icon, Popup } from \"@lib/elements\"\n  import Viewer from \"./Viewer.svelte\"\n\n  const dispatch = createEventDispatcher<{ photo: Blob }>()\n\n  let viewer: Viewer\n  let countdown: ReturnType<typeof createCountdown> | null = null\n  let flash = false\n\n  $: hasFace = false\n  $: hasLight = false\n  $: hint = hasFace ? \"Please, don’t move\" : \"Put your face in the frame\"\n\n  $: flash && viewer.takePhoto().then((photo) => dispatch(\"photo\", photo))\n  $: hasFace ? (countdown = createCountdown(3)) : (countdown = null)\n</script>\n\n<section\n  class:flash={countdown && $countdown === 0}\n  class=\"tint-face-analysis\"\n  on:transitionend={() => (flash = true)}\n>\n  <div class=\"viewer\" class:hasLight class:hasFace>\n    <Viewer\n      bind:this={viewer}\n      on:hasFace={({ detail }) => (hasFace = detail)}\n      on:hasLight={({ detail }) => (hasLight = detail)}\n    />\n    {#if countdown}<span class=\"countdown\">{$countdown}</span>{/if}\n    <span class=\"hint\">{hint}</span>\n\n    <dialog class:hasLight class:hasFace>\n      <Icon variant=\"info-circle\" />\n      <p>Not enough light</p>\n    </dialog>\n  </div>\n  <article>\n    <h2>Face analysis</h2>\n    <p>We will analyze your face and suggest personalized products</p>\n  </article>\n</section>\n\n<style lang=\"postcss\">\n  section {\n    @apply flex h-full w-full flex-col lg:flex-row;\n    @apply xl:max-h-[48.5rem] xl:max-w-[75rem] xl:rounded-xl;\n  }\n\n  dialog {\n    @apply bottom-1 z-10 flex h-8 w-[12rem] items-center justify-center gap-1 rounded-lg bg-[#f9b74a] text-sm text-[#38383c] lg:bottom-5 lg:h-14;\n\n    &.hasLight,\n    &:not(.hasFace) {\n      @apply hidden;\n    }\n  }\n\n  section {\n    @apply relative;\n\n    &::after {\n      @apply pointer-events-none absolute top-0 left-0 z-10 h-full w-full bg-white transition-opacity delay-700 duration-200 content-[\"\"];\n    }\n\n    &:not(.flash)::after {\n      @apply opacity-0;\n    }\n  }\n\n  div {\n    /** See best-match/BestMatch.svelte for the CSS explanation */\n    @apply relative flex w-full shrink-0 grow flex-col bg-[#f4f4f4] md:grow-0 md:pb-[calc(576/768*100%)] lg:pb-0;\n    @apply lg:w-[calc(430/(1024)*100%)] xl:w-[calc(568/(1200)*100%)];\n\n    @apply lg:order-2 lg:m-6 lg:ml-0 xl:m-8 xl:ml-0;\n\n    & > :global(:first-child) {\n      @apply absolute top-0 left-0 h-full w-full lg:relative lg:h-full lg:grow;\n    }\n  }\n\n  div::after {\n    @apply absolute top-0 left-0 h-full w-full bg-black/40 content-[\"\"];\n\n    background: url(\"data:image/svg+xml,%3Csvg viewBox='-30 -40 373 500' xmlns='http://www.w3.org/2000/svg'%3E%3Cellipse cx='154.5' cy='218.5' rx='154.5' ry='218.5' stroke='%23FFF' stroke-width='5' fill-rule='evenodd'/%3E%3C/svg%3E%0A\")\n        center / contain no-repeat,\n      rgba(0, 0, 0, 0.4);\n    mask: linear-gradient(#000, #000),\n      url(\"data:image/svg+xml,%3Csvg viewBox='-30 -40 373 500' xmlns='http://www.w3.org/2000/svg'%3E%3Cellipse cx='154.5' cy='218.5' rx='154.5' ry='218.5' fill='%23000' fill-rule='evenodd'/%3E%3C/svg%3E%0A\")\n        center / contain no-repeat;\n    mask-composite: exclude;\n\n    @media (min-width: 768px) {\n      background: url(\"data:image/svg+xml,%3Csvg  viewBox='-60 -60 575 645' xmlns='http://www.w3.org/2000/svg'%3E%3Cellipse cx='227.5' cy='262.5' rx='227.5' ry='262.5' stroke='%23FFF' stroke-width='5' fill-rule='evenodd'/%3E%3C/svg%3E%0A\")\n          center / contain no-repeat,\n        rgba(0, 0, 0, 0.4);\n\n      mask: linear-gradient(#000, #000),\n        url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='-60 -60 575 645'%3E%%3Cellipse cx='227.5' cy='262.5' rx='227.5' ry='262.5' fill='%23fff'/%3E%3C/svg%3E%0A\")\n          center / contain no-repeat;\n      mask-composite: exclude;\n    }\n  }\n\n  div.hasFace::after {\n    background: url(\"data:image/svg+xml,%3Csvg viewBox='-30 -40 373 500' xmlns='http://www.w3.org/2000/svg'%3E%3Cellipse cx='154.5' cy='218.5' rx='154.5' ry='218.5' stroke='%23fb4' stroke-width='5' fill-rule='evenodd'/%3E%3C/svg%3E%0A\")\n        center / contain no-repeat,\n      rgba(0, 0, 0, 0.4);\n    @media (min-width: 768px) {\n      background: url(\"data:image/svg+xml,%3Csvg  viewBox='-60 -60 575 645' xmlns='http://www.w3.org/2000/svg'%3E%3Cellipse cx='227.5' cy='262.5' rx='227.5' ry='262.5' stroke='%23fb4' stroke-width='5' fill-rule='evenodd'/%3E%3C/svg%3E%0A\")\n          center / contain no-repeat,\n        rgba(0, 0, 0, 0.4);\n    }\n  }\n\n  div.hasFace.hasLight::after {\n    background: url(\"data:image/svg+xml,%3Csvg viewBox='-30 -40 373 500' xmlns='http://www.w3.org/2000/svg'%3E%3Cellipse cx='154.5' cy='218.5' rx='154.5' ry='218.5' stroke='%231ea' stroke-width='5' fill-rule='evenodd'/%3E%3C/svg%3E%0A\")\n        center / contain no-repeat,\n      rgba(0, 0, 0, 0.4);\n    @media (min-width: 768px) {\n      background: url(\"data:image/svg+xml,%3Csvg  viewBox='-60 -60 575 645' xmlns='http://www.w3.org/2000/svg'%3E%3Cellipse cx='227.5' cy='262.5' rx='227.5' ry='262.5' stroke='%231ea' stroke-width='5' fill-rule='evenodd'/%3E%3C/svg%3E%0A\")\n          center / contain no-repeat,\n        rgba(0, 0, 0, 0.4);\n    }\n  }\n\n  div {\n    @apply text-base font-bold text-white;\n  }\n\n  span {\n    @apply w-max;\n  }\n\n  .countdown {\n    @apply absolute left-10 z-10 text-[3.375rem] leading-[1.22]  [text-shadow:0_3px_8px_rgba(0,0,0,0.5)];\n    @apply md:left-[7.5rem] lg:left-10 lg:text-[5.25rem] lg:leading-[1.38];\n  }\n\n  .hint {\n    @apply absolute top-3 left-1/2 z-10 -translate-x-1/2 lg:text-2xl;\n  }\n\n  article {\n    @apply mx-auto flex flex-col gap-4 px-10 py-7 md:max-w-[33.375rem] md:grow md:gap-5 md:py-10 lg:mt-[12.5rem] lg:max-w-[29.375rem] lg:pr-2.5;\n  }\n\n  h2 {\n    @apply text-xl md:text-2xl;\n  }\n\n  p {\n    @apply text-sm md:text-base;\n  }\n</style>\n"],"file":"assets/CameraFrameCapture.20d1d1a4.js"}